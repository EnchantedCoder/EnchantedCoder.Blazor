@namespace EnchantedCoder.Blazor.Components.Web.Bootstrap.Internal
@typeparam TItem
@typeparam TValue

<div id="@dropdownId" class="@CssClassHelper.Combine("dropdown", HasInputGroupsEffective ? "input-group" : null, InputGroupCssClass)">
    @if (InputGroupStartText is not null)
    {
        <span class="input-group-text">@InputGroupStartText</span>
    }

    @InputGroupStartTemplate

    <div class="@CssClassHelper.Combine("ec-autosuggest-input-wrapper", (LabelTypeEffective == EnchantedCoder.Blazor.Components.Web.Bootstrap.LabelType.Floating) ? "form-floating" : null)">
        <EcAutosuggestInputInternal @ref="autosuggestInput"
                            InputId="@InputId"
                            EnabledEffective="@EnabledEffective"
                            Value="@userInput"
                            OnInput="HandleInputInput"
                            OnFocus="HandleInputFocus"
                            OnBlur="HandleInputBlur"
                            Placeholder="@Placeholder"
                            CssClass="@InputCssClass"
                            DropdownOffset="@DropdownOffset"
                            AdditionalAttributes="this.AdditionalAttributes" />

        @if (LabelTypeEffective == EnchantedCoder.Blazor.Components.Web.Bootstrap.LabelType.Floating)
        {
            <EcFormValueComponentRenderer_Label FormValueComponent="@FormValueComponent" />
        }
        @if (EnabledEffective)
        {
            <div class="ec-autosuggest-input-icon">
                @if (dataProviderInProgress)
                {
                    <div>
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    </div>
                }
                else if (!EqualityComparer<TValue>.Default.Equals(Value, default))
                {
                    if (this.ClearIconEffective is not null)
                    {
                        <div role="button" @onclick="HandleCrossClick" @onclick:stopPropagation>
                            <EcIcon CssClass="ec-autosuggest-input-icon-clear" Icon="ClearIconEffective" />
                        </div>
                    }
                }
                else if (this.SearchIconEffective is not null)
                {
                    <EcIcon CssClass="ec-autosuggest-input-icon-search" Icon="@SearchIconEffective" />
                }
            </div>
            <EcAutosuggestItemsInternal
                                    TItem="TItem"
                                    Items="@suggestions"
                                    OnItemClick="HandleItemSelected"
                                    FocusedItemIndex="focusedItemIndex"
                                    FocusedItemCssClass="ec-autosuggest-item-focused">

                <ItemTemplate>
                    @if (ItemTemplate != null)
                    {
                        <text>@ItemTemplate(context)</text>
                    }
                    else
                    {
                        <text>@TextSelectorEffective(context)</text>
                    }
                </ItemTemplate>
                <EmptyTemplate>
                    @EmptyTemplate
                </EmptyTemplate>

            </EcAutosuggestItemsInternal>
        }
    </div>

    @InputGroupEndTemplate

    @if (InputGroupEndText is not null)
    {
        <span class="input-group-text">@InputGroupEndText</span>
    }
</div>
