@namespace EnchantedCoder.Blazor.Components.Web.Bootstrap
<CascadingValue Value="this" IsFixed="true">
    <div>
        @if (!HasExpandableContent)
        {
            <EcNavLink Href="@Href"
                   CssClass="@CssClassHelper.Combine(this.DropdownContainer is not null ? "dropdown-item" : null, this.CssClass, "position-relative")"
                   Match="this.Match"
                   Enabled="this.Enabled">

                @* To hide the nav-content in mobile view *@
                <div data-bs-toggle="collapse" data-bs-target="#@ParentSidebar.NavContentElementId" class="stretched-link">
                    <div class="ec-sidebar-item-navlink-content">
                        @if (Icon is not null)
                        {
                            <EcIcon Icon="Icon" />
                        }

                        <span class="ec-sidebar-item-navlink-content-inner">
                            @if (ContentTemplate is not null)
                            {
                                @ContentTemplate(new(){ ItemExpanded = null })
                            }
                            @Text
                        </span>
                    </div>

                </div>
            </EcNavLink>
        }
        else
        {
                RenderFragment itemNavLinkContent =
                @<div class="ec-sidebar-item-navlink-content">
                    @if (Icon is not null)
                    {
                        <EcIcon Icon="Icon" />
                    }

                    <span class="ec-sidebar-item-navlink-content-inner">
                        @if (ContentTemplate is not null)
                        {
                            @ContentTemplate(new() { ItemExpanded = this.expanded })
                        }
                        @Text
                    </span>

                    <EcIcon Icon="@BootstrapIcon.ChevronRight" CssClass="expand-icon" />
                </div>;

            @if (ParentSidebar.Collapsed)
            {
                <EcDropdown Direction="DropdownDirection.End" CssClass="ec-sidebar-item">
                    <EcNavLink
                           Href="@Href"
                           CssClass="@CssClassHelper.Combine(this.CssClass)"
                           Match="this.Match"
                           Enabled="this.Enabled"
                           role="button"
                           data-bs-toggle="dropdown"
                           aria-expanded="@(this.expanded ? "true" : "false")">

                           @itemNavLinkContent

                    </EcNavLink>

                    <EcDropdownMenu CssClass="ec-sidebar-subitems">
                        @ChildContent
                    </EcDropdownMenu>

                </EcDropdown>
            }
            else
            {
                <EcNavLink
                        Href="@Href"
                        CssClass="@CssClassHelper.Combine(this.CssClass)"
                        Match="this.Match"
                        Enabled="this.Enabled"
                        role="button"
                        data-bs-toggle="collapse"
                        data-bs-target="@("#" + id)"
                        aria-expanded="@(this.expanded ? "true" : "false")">

                        @itemNavLinkContent

                </EcNavLink>

                <EcCollapse
                    Id="@id"
                    Parent="@(ParentSidebar.MultipleItemsExpansion ? null : $"#{ParentSidebar.navId}")"
                    @ref="collapseComponent"
                    CssClass="ec-sidebar-subitems"
                    InitiallyExpanded="expanded"
                    OnShown="HandleCollapseShown"
                    OnHidden="HandleCollapseHidden">
                    <nav class="nav ec-sidebar-collapsed-nav">
                        @ChildContent
                    </nav>
                </EcCollapse>
            }
        }
    </div>
</CascadingValue>