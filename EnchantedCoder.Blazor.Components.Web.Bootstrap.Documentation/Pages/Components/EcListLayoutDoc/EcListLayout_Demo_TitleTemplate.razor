<EcListLayout TFilterModel="FilterModelDto">
    <TitleTemplate>
        Culture infos <EcBadge Color="ThemeColor.Light" TextColor="ThemeColor.Dark" CssClass="ms-1">@localEditableCultureInfos.Count</EcBadge>
    </TitleTemplate>
    <CommandsTemplate>
        <EcButton Text="New item" Color="ThemeColor.Primary" Icon="BootstrapIcon.PlusLg" OnClick="NewItemClicked" />
    </CommandsTemplate>
    <DataTemplate>
        <EcGrid @ref="gridComponent" Responsive="true" ContentNavigationMode="GridContentNavigationMode.Pagination" TItem="EditableCultureInfo" PageSize="10" DataProvider="LoadDataItems" SelectedDataItem="currentItem" SelectedDataItemChanged="HandleSelectedDataItemChanged">
            <Columns>
                <EcGridColumn HeaderText="LCID" ItemTextSelector="@(item => item.LCID.ToString())" SortKeySelector="@(item => item.LCID)" IsDefaultSortColumn="true" />
		        <EcGridColumn HeaderText="DisplayName" ItemTextSelector="@(item => item.DisplayName)" SortKeySelector="@(item => item.DisplayName)" />
		        <EcGridColumn HeaderText="Name" ItemTextSelector="@(item => item.Name)" SortKeySelector="@(item => item.Name)"  />
		        <EcGridColumn HeaderText="EnglishName" ItemTextSelector="@(item => item.EnglishName)" SortKeySelector="@(item => item.EnglishName)"  />
				<EcContextMenuGridColumn Context="item">
					<EcContextMenu>
						<EcContextMenuItem Text="Delete" OnClick="async () => await DeleteItemClicked(item)" ConfirmationQuestion="@($"Are you sure you want to delete {item.Name}?")" />
					</EcContextMenu>
				</EcContextMenuGridColumn>
            </Columns>
        </EcGrid>
    </DataTemplate>
    <DetailTemplate>
        Edit: @currentItem?.LCID
    </DetailTemplate>
</EcListLayout>

@code {
    [Inject] protected NavigationManager NavigationManager { get; set; }

    private EditableCultureInfo currentItem;
    private EcGrid<EditableCultureInfo> gridComponent;

    private List<EditableCultureInfo> localEditableCultureInfos = CultureInfo.GetCultures(CultureTypes.AllCultures).Select(c => new EditableCultureInfo()
        {
            LCID = c.LCID,
            DisplayName = c.DisplayName,
            Name = c.Name,
            EnglishName = c.EnglishName
        }).ToList();

    private Task<GridDataProviderResult<EditableCultureInfo>> LoadDataItems(GridDataProviderRequest<EditableCultureInfo> request)
    {
        IEnumerable<EditableCultureInfo> result = localEditableCultureInfos.ToList();

        return Task.FromResult(request.ApplyTo(result));
    }

    private async Task DeleteItemClicked(EditableCultureInfo editableCultureInfo)
    {
        localEditableCultureInfos.Remove(editableCultureInfo);
        await gridComponent.RefreshDataAsync();
    }

    private Task HandleSelectedDataItemChanged(EditableCultureInfo selection)
    {
        currentItem = selection;
        // await dataItemEditComponent.ShowAsync();
        return Task.CompletedTask;
    }

    private Task NewItemClicked()
    {
        currentItem = new();
        // await dataItemEditComponent.ShowAsync();
        return Task.CompletedTask;
    }

    public record FilterModelDto { }

    private record EditableCultureInfo
    {
        public int LCID { get; set; }
        public string DisplayName { get; set; }
        public string Name { get; set; }
        public string EnglishName { get; set; }
    }
}
